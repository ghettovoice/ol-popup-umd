!function(a,b){"function"==typeof define&&define.amd?define(["openlayers"],b):"object"==typeof exports?module.exports=b(require("openlayers")):a.ol.Overlay.Popup=b(a.ol)}(this,function(a){return a.Overlay.Popup=function(a){function b(b){var c=b||{};this.panMapIfOutOfView=c.panMapIfOutOfView,void 0===this.panMapIfOutOfView&&(this.panMapIfOutOfView=!0),this.ani=c.ani,void 0===this.ani&&(this.ani=a.animation.pan),this.ani_opts=c.ani_opts,void 0===this.ani_opts&&(this.ani_opts={duration:250}),this.container=document.createElement("div"),this.container.className="ol-popup",this.closer=document.createElement("a"),this.closer.className="ol-popup-closer",this.closer.href="#",this.container.appendChild(this.closer);var e=this;this.closer.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),e.hide()}),["click","focus"].forEach(function(a){this.container.addEventListener(a,function(){e.bringToFront()})},this),this.content=document.createElement("div"),this.content.className="ol-popup-content",this.container.appendChild(this.content),d(this.content),c.content&&this.setContent(c.content),c.element=this.container,a.Overlay.call(this,c)}function c(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function d(a){if(c()){var b=0;a.addEventListener("touchstart",function(a){b=this.scrollTop+a.touches[0].pageY},!1),a.addEventListener("touchmove",function(a){this.scrollTop=b-a.touches[0].pageY},!1)}}var e={SHOW:"show",HIDE:"hide"};return a.inherits(b,a.Overlay),b.prototype.setContent=function(a){return a instanceof Element?this.content.appendChild(a):"string"==typeof a&&(this.content.innerHTML=a),this},b.prototype.setMap=function(b){a.Overlay.prototype.setMap.call(this,b),null!=b&&this.bringToFront()},b.prototype.getContent=function(){return this.content},b.prototype.show=function(a,b){return b&&this.setContent(b),this.setPosition(a),this.container.style.display="block",this.panMapIfOutOfView&&this.panIntoView(a),this.dispatchEvent(e.SHOW),this.set("visibility",!0),this},b.prototype.panIntoView=function(a){var b={width:this.getElement().clientWidth+20,height:this.getElement().clientHeight+20},c=this.getMap().getSize(),d=20,e=60,f=b.width-e,g=this.getOffset(),h=this.getMap().getPixelFromCoordinate(a),i=h[0]-e,j=c[0]-(h[0]+f),k=h[1]-b.height+g[1],l=c[1]-(h[1]+d)-g[1],m=this.getMap().getView().getCenter(),n=this.getMap().getPixelFromCoordinate(m),o=n.slice();return 0>j?o[0]-=j:0>i&&(o[0]+=i),0>k?o[1]+=k:0>l&&(o[1]-=l),this.ani&&this.ani_opts&&(this.ani_opts.source=m,this.getMap().beforeRender(this.ani(this.ani_opts))),(o[0]!==n[0]||o[1]!==n[1])&&this.getMap().getView().setCenter(this.getMap().getCoordinateFromPixel(o)),this.getMap().getView().getCenter()},b.prototype.hide=function(){return this.container.style.display="none",this.closer.blur(),this.dispatchEvent(e.HIDE),this.set("visibility",!1),this},b.prototype.bringToFront=function(){var a=this.container.parentNode,b=a.parentNode,c=[].slice.call(b.querySelectorAll(".ol-overlay-container")).pop();return c&&c!==a&&b.insertBefore(a,c.nextSibling),this},b}(a),a.Overlay.Popup});